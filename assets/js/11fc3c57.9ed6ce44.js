"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[798],{3905:(e,r,t)=>{t.d(r,{Zo:()=>l,kt:()=>m});var n=t(7294);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?s(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=n.createContext({}),u=function(e){var r=n.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):o(o({},r),e)),t},l=function(e){var r=u(e.components);return n.createElement(c.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),d=u(t),m=a,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||s;return t?n.createElement(h,o(o({ref:r},l),{},{components:t})):n.createElement(h,o({ref:r},l))}));function m(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var s=t.length,o=new Array(s);o[0]=d;var i={};for(var c in r)hasOwnProperty.call(r,c)&&(i[c]=r[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var u=2;u<s;u++)o[u]=t[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},8059:(e,r,t)=>{t.r(r),t.d(r,{contentTitle:()=>o,default:()=>l,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var n=t(7462),a=(t(7294),t(3905));const s={sidebar_position:4},o="Restoring purchases",i={unversionedId:"usage_instructions/restoring_purchases",id:"usage_instructions/restoring_purchases",title:"Restoring purchases",description:"You can use getAvailablePurchases() to do what's commonly understood as \u201crestoring\u201d purchases.",source:"@site/docs/usage_instructions/restoring_purchases.md",sourceDirName:"usage_instructions",slug:"/usage_instructions/restoring_purchases",permalink:"/docs/usage_instructions/restoring_purchases",editUrl:"https://github.com/dooboolab/react-native-iap/edit/main/docs/docs/usage_instructions/restoring_purchases.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Making a purchase",permalink:"/docs/usage_instructions/purchase"},next:{title:"Validating receipts",permalink:"/docs/usage_instructions/receipt_validation"}},c=[],u={toc:c};function l(e){let{components:r,...t}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,t,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"restoring-purchases"},"Restoring purchases"),(0,a.kt)("p",null,"You can use ",(0,a.kt)("inlineCode",{parentName:"p"},"getAvailablePurchases()")," to do what's commonly understood as \u201crestoring\u201d purchases."),(0,a.kt)("p",null,"If for debugging you want to consume all items, you have to iterate over the purchases returned by ",(0,a.kt)("inlineCode",{parentName:"p"},"getAvailablePurchases()"),". Beware that if you consume an item without having recorded the purchase in your database the user may have paid for something without getting it delivered and you will have no way to recover the receipt to validate and restore their purchase."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"  getPurchases = async () => {\n    try {\n      const purchases = await RNIap.getAvailablePurchases();\n      const newState = { premium: false, ads: true }\n      let restoredTitles = [];\n\n      purchases.forEach(purchase => {\n        switch (purchase.productId) {\n        case 'com.example.premium':\n          newState.premium = true\n          restoredTitles.push('Premium Version');\n          break\n\n        case 'com.example.no_ads':\n          newState.ads = false\n          restoredTitles.push('No Ads');\n          break\n\n        case 'com.example.coins100':\n          await RNIap.finishTransaction(purchase.purchaseToken);\n          CoinStore.addCoins(100);\n        }\n      })\n\n      Alert.alert('Restore Successful', 'You successfully restored the following purchases: ' + restoredTitles.join(', '));\n    } catch(err) {\n      console.warn(err); // standardized err.code and err.message available\n      Alert.alert(err.message);\n    }\n  }\n")),(0,a.kt)("p",null,"Each item from ",(0,a.kt)("inlineCode",{parentName:"p"},"getAvailablePurchases()")," contains a ",(0,a.kt)("a",{parentName:"p",href:"../api_reference/available_purchase"},"AvailablePurchase object"),"."))}l.isMDXComponent=!0}}]);